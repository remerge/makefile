# Makefile Framework

Makefile framework for all remerge projects.

## Getting Started

For a new project that does not use the Makefile framework yet, add this
repository as a subtree:

```bash
git remote add makefile https://github.com/remerge/makefile
git subtree add --squash --prefix mkf/common makefile main
```

Afterwards make targets can be included in the project:

```bash
$ cat Makefile
include mkf/common/common.mk
```

## Adding Modules

Use `make add` to add modules to the Makefile framework for the current project:

```bash
$ make add MODULE=remerge/example-makefile
git remote add example-makefile https://github.com/remerge/example-makefile
git subtree add --squash --prefix mkf/example example-makefile main
git fetch example-makefile main
From ssh://github.com/remerge/example-makefile
 * branch            main       -> FETCH_HEAD
 * [new branch]      main       -> example-makefile/main
Added dir 'mkf/example'
```

## Updating Modules

Use `make update` to update all modules from the Makefile framework:

```bash
make update
```

## Available Makefile Targets

| Name      | File        | Description                                                                                  |
| --------- | ----------- | -------------------------------------------------------------------------------------------- |
| help      | help.mk     | display this help text                                                                       |
| clean     | prepare.mk  | remove all build artifacts generated by `make all`                                           |
| distclean | prepare.mk  | remove all artifacts, caches, dependencies, settings and reset branch to remote (DANGEROUS!) |
| dep       | prepare.mk  | alias for install                                                                            |
| install   | prepare.mk  | prepare environment and install dependencies for all make targets                            |
| up        | prepare.mk  | alias for update                                                                             |
| update    | prepare.mk  | update environment and all dependencies to their latest version(s)                           |
| gen       | generate.mk | alias for generate                                                                           |
| generate  | generate.mk | generate documentation, schemas, etc                                                         |
| fmt       | generate.mk | alias for format                                                                             |
| format    | generate.mk | format source code to conform to coding style and best practices                             |
| lint      | test.mk     | run code format check, code analysis, security scans, etc                                    |
| test      | test.mk     | run unit and integration tests                                                               |
| build     | build.mk    | run all build steps and create artifact(s)                                                   |
| add       | mkf.mk      | add makefile framework module                                                                |
| update    | mkf.mk      | update all makefile framework modules                                                        |
